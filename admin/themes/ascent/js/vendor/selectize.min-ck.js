/*! selectize.js - v0.6.14 | https://github.com/brianreavis/selectize.js | Apache License (v2) */(function(e){"object"==typeof exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){var t=function(e,t){if("string"!=typeof t||t.length){var n="string"==typeof t?RegExp(t,"i"):t,r=function(e){var t=0;if(3===e.nodeType){var i=e.data.search(n);if(0<=i&&0<e.data.length){var s=e.data.match(n),t=document.createElement("span");t.className="highlight";e=e.splitText(i);e.splitText(s[0].length);i=e.cloneNode(!0);t.appendChild(i);e.parentNode.replaceChild(t,e);t=1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(i=0;i<e.childNodes.length;++i)i+=r(e.childNodes[i]);return t};return e.each(function(){r(this)})}},n=function(){};n.prototype={on:function(e,t){this._events=this._events||{};this._events[e]=this._events[e]||[];this._events[e].push(t)},off:function(e,t){this._events=this._events||{};0!=e in this._events&&this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){this._events=this._events||{};if(0!=e in this._events)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}};n.mixin=function(e){for(var t=["on","off","trigger"],r=0;r<t.length;r++)e.prototype[t[r]]=n.prototype[t[r]]};var r=/Mac/.test(navigator.userAgent),i=r?91:17,s=r?18:17,o={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇç]",e:"[eÈÉÊËèéêë]",i:"[iÌÍÎÏìíîï]",n:"[nÑñ]",o:"[oÒÓÔÕÕÖØòóôõöø]",s:"[sŠš]",u:"[uÙÚÛÜùúûü]",y:"[yŸÿý]",z:"[zŽž]"},u=function(e){return"undefined"!=typeof e},a=function(e){return"undefined"==typeof e||null===e?"":"boolean"==typeof e?e?"1":"0":e+""},f=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},l=function(e){return e.replace(/(['"])/g,"\\$1")},c={before:function(e,t,n){var r=e[t];e[t]=function(){n.apply(e,arguments);return r.apply(e,arguments)}},after:function(e,t,n){var r=e[t];e[t]=function(){var t=r.apply(e,arguments);n.apply(e,arguments);return t}}},h=function(t,n){if(!e.isArray(n))return n;var r,i,s={};r=0;for(i=n.length;r<i;r++)n[r].hasOwnProperty(t)&&(s[n[r][t]]=n[r]);return s},p=function(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}},d=function(e,t){var n;return function(){var r=this,i=arguments;window.clearTimeout(n);n=window.setTimeout(function(){e.apply(r,i)},t)}},v=function(e,t,n){var r,i=e.trigger,s={};e.trigger=function(){var n=arguments[0];if(-1===t.indexOf(n))return i.apply(e,arguments);s[n]=arguments};n.apply(e,[]);e.trigger=i;for(r in s)s.hasOwnProperty(r)&&i.apply(e,s[r])},m=function(e,t,n,r){e.on(t,n,function(t){for(var n=t.target;n&&n.parentNode!==e[0];)n=n.parentNode;t.currentTarget=n;return r.apply(this,[t])})},g=function(e){var t={};if("selectionStart"in e)t.start=e.selectionStart,t.length=e.selectionEnd-t.start;else if(document.selection){e.focus();var n=document.selection.createRange(),r=document.selection.createRange().text.length;n.moveStart("character",-e.value.length);t.start=n.text.length-r;t.length=r}return t},y=function(t){var n=function(n){var r,i,s;n=n||window.event||{};if(!n.metaKey&&!n.altKey&&!1!==t.data("grow")){r=t.val();n.type&&"keydown"===n.type.toLowerCase()&&(i=n.keyCode,s=97<=i&&122>=i||65<=i&&90>=i||48<=i&&57>=i||32==i,46===i||8===i?(n=g(t[0]),n.length?r=r.substring(0,n.start)+r.substring(n.start+n.length):8===i&&n.start?r=r.substring(0,n.start-1)+r.substring(n.start+1):46===i&&"undefined"!=typeof n.start&&(r=r.substring(0,n.start)+r.substring(n.start+1))):s&&(i=n.shiftKey,n=String.fromCharCode(n.keyCode),n=i?n.toUpperCase():n.toLowerCase(),r+=n));n=t.attr("placeholder")||"";!r.length&&n.length&&(r=n);r=e("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"nowrap"}).text(r).appendTo("body");n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];var o={};if(n)for(i=0,s=n.length;i<s;i++)o[n[i]]=t.css(n[i]);else o=t.css();r.css(o);n=r.width();r.remove();r=n+4;r!==t.width()&&(t.width(r),t.triggerHandler("resize"))}};t.on("keydown keyup update blur",n);n()},b=function(t,n){t[0].selectize=this;e.extend(this,{settings:n,$input:t,tagType:"select"===t[0].tagName.toLowerCase()?1:2,highlightedValue:null,isOpen:!1,isDisabled:!1,isLocked:!1,isFocused:!1,isInputFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:d(this.onSearchChange,n.loadThrottle)});e.extend(this.options,h(n.valueField,n.options));delete this.settings.options;e.extend(this.optgroups,h(n.optgroupValueField,n.optgroups));delete this.settings.optgroups;this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi");"boolean"!=typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode);this.loadPlugins(this.settings.plugins);this.setupCallbacks();this.setup()};n.mixin(b);(function(t,n){t.plugins={};t.prototype.loadPlugins=function(t){var n,r;this.plugins=[];this.pluginSettings={};if(e.isArray(t))for(n=0,r=t.length;n<r;n++)this.loadPlugin(t[n]);else if(t)for(n in this.pluginSettings=e.extend({},t),t)t.hasOwnProperty(n)&&this.loadPlugin(n)};t.prototype.loadPlugin=function(e){var r,i,s;if(-1===this.plugins.indexOf(e)){if(!t.plugins.hasOwnProperty(e))throw Error(n+' unable to find "'+e+'" plugin');r=t.plugins[e];this.plugins.push(e);i=0;for(s=r.dependencies.length;i<s;i++)this.loadPlugin(r.dependencies[i]);r.fn.apply(this,[this.pluginSettings[e]||{}])}};t.registerPlugin=function(e){var n=arguments;t.plugins[e]={name:e,fn:n[n.length-1],dependencies:3===n.length?n[1]:[]}}})(b,"Selectize");e.extend(b.prototype,{setup:function(){var t=this,n=t.settings,o,u,a,f,l,c;a=t.$input.attr("tabindex")||"";o=t.$input.attr("class")||"";o=e("<div>").addClass(n.theme).addClass(n.wrapperClass).addClass(o);u=e("<div>").addClass(n.inputClass).addClass("items").toggleClass("has-options",!e.isEmptyObject(t.options)).appendTo(o);a=e('<input type="text">').appendTo(u).attr("tabindex",a);f=e(n.dropdownParent||o);f=e("<div>").addClass(n.dropdownClass).hide().appendTo(f);l=e("<div>").addClass(n.dropdownContentClass).appendTo(f);o.css({width:t.$input[0].style.width,display:t.$input.css("display")});t.plugins.length&&o.addClass("plugin-"+t.plugins.join(" plugin-"));c=t.settings.mode;o.toggleClass("single","single"===c);o.toggleClass("multi","multi"===c);(null===n.maxItems||1<n.maxItems)&&1===t.tagType&&t.$input.attr("multiple","multiple");t.settings.placeholder&&a.attr("placeholder",n.placeholder);t.$wrapper=o;t.$control=u;t.$control_input=a;t.$dropdown=f;t.$dropdown_content=l;u.on("mousedown",function(e){e.isDefaultPrevented()||window.setTimeout(function(){t.focus(!0)},0)});u.on("click",function(e){t.isInputFocused||t.focus(!0)});f.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)});f.on("mousedown","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)});m(u,"mousedown","*:not(input)",function(){return t.onItemSelect.apply(t,arguments)});y(a);a.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){return t.onFocus.apply(t,arguments)}});e(document).on({keydown:function(e){t.isCmdDown=e[r?"metaKey":"ctrlKey"];t.isCtrlDown=e[r?"altKey":"ctrlKey"];t.isShiftDown=e.shiftKey},keyup:function(e){e.keyCode===s&&(t.isCtrlDown=!1);16===e.keyCode&&(t.isShiftDown=!1);e.keyCode===i&&(t.isCmdDown=!1)},mousedown:function(e){if(t.isFocused)if(e.target===t.$dropdown[0]||e.target.parentNode===t.$dropdown[0]){var n=t.ignoreFocus;t.ignoreFocus=!0;window.setTimeout(function(){t.ignoreFocus=n;t.focus(!1)},0)}else t.$control.has(e.target).length||e.target===t.$control[0]||t.blur()}});e(window).on({"scroll resize":function(){t.isOpen&&t.positionDropdown.apply(t,arguments)},mousemove:function(){t.ignoreHover=!1}});t.$input.attr("tabindex",-1).hide().after(t.$wrapper);e.isArray(n.items)&&(t.setValue(n.items),delete n.items);t.updateOriginalInput();t.refreshItems();t.updatePlaceholder();t.isSetup=!0;t.$input.is(":disabled")&&t.disable();t.trigger("initialize");n.preload&&t.onSearchChange("")},setupCallbacks:function(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(e in n)n.hasOwnProperty(e)&&(t=this.settings[n[e]])&&this.on(e,t)},triggerCallback:function(e){var t;"function"==typeof this.settings[e]&&(t=Array.prototype.slice.apply(arguments,[1]),this.settings[e].apply(this,t))},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);if(this.settings.create&&t===this.settings.delimiter)return this.createItem(),e.preventDefault(),!1},onKeyDown:function(t){if(this.isLocked)9!==t.keyCode&&t.preventDefault();else{switch(t.keyCode){case 65:if(this.isCmdDown){this.selectAll();return}break;case 27:this.blur();return;case 40:if(!this.isOpen&&this.hasOptions)this.open();else if(this.$activeOption){this.ignoreHover=!0;var n=this.getAdjacentOption(this.$activeOption,1);n.length&&this.setActiveOption(n,!0,!0)}t.preventDefault();return;case 38:this.$activeOption&&(this.ignoreHover=!0,n=this.getAdjacentOption(this.$activeOption,-1),n.length&&this.setActiveOption(n,!0,!0));t.preventDefault();return;case 13:this.$activeOption&&this.onOptionSelect({currentTarget:this.$activeOption});t.preventDefault();return;case 37:this.advanceSelection(-1,t);return;case 39:this.advanceSelection(1,t);return;case 9:this.settings.create&&e.trim(this.$control_input.val()).length&&(this.createItem(),t.preventDefault());return;case 8:case 46:this.deleteSelection(t);return}(this.isFull()||this.isInputHidden)&&t.preventDefault()}},onKeyUp:function(e){if(this.isLocked)return e&&e.preventDefault();e=this.$control_input.val()||"";this.lastValue!==e&&(this.lastValue=e,this.onSearchChange(e),this.refreshOptions(),this.trigger("type",e))},onSearchChange:function(e){var t=this,n=t.settings.load;n&&!t.loadedSearches.hasOwnProperty(e)&&(t.loadedSearches[e]=!0,t.load(function(r){n.apply(t,[e,r])}))},onFocus:function(e){this.isFocused=this.isInputFocused=!0;if(this.isDisabled)return this.blur(),e.preventDefault(),!1;if(!this.ignoreFocus){"focus"===this.settings.preload&&this.onSearchChange("");this.showInput();this.setActiveItem(null);this.refreshOptions(!!this.settings.openOnFocus);this.refreshClasses()}},onBlur:function(e){this.isInputFocused=!1;this.ignoreFocus||(this.close(),this.setTextboxValue(""),this.setActiveItem(null),this.setActiveOption(null),this.setCaret(this.items.length),this.isFocused=!1,this.refreshClasses())},onOptionHover:function(e){this.ignoreHover||this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(t){var n;t.preventDefault&&t.preventDefault();t.stopPropagation&&t.stopPropagation();this.focus(!1);n=e(t.currentTarget);if(n.hasClass("create"))this.createItem();else if(n=n.attr("data-value"))this.setTextboxValue(""),this.addItem(n),!this.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&this.setActiveOption(this.getOption(n))},onItemSelect:function(e){"multi"===this.settings.mode&&(e.preventDefault(),this.setActiveItem(e.currentTarget,e),this.focus(!1),this.hideInput())},load:function(e){var t=this,n=t.$wrapper.addClass("loading");t.loading++;e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0);e&&e.length&&(t.addOption(e),t.refreshOptions(!1),t.isInputFocused&&t.open());t.loading||n.removeClass("loading");t.trigger("load",e)}])},setTextboxValue:function(e){this.$control_input.val(e).triggerHandler("update");this.lastValue=e},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t){v(this,["change"],function(){this.clear();for(var n=e.isArray(t)?t:[t],r=0,i=n.length;r<i;r++)this.addItem(n[r])})},setActiveItem:function(t,n){var r,i,s;t=e(t);if(t.length){r=n&&n.type.toLowerCase();if("mousedown"===r&&this.isShiftDown&&this.$activeItems.length){r=this.$control.children(".active:last");i=Array.prototype.indexOf.apply(this.$control[0].childNodes,[r[0]]);r=Array.prototype.indexOf.apply(this.$control[0].childNodes,[t[0]]);i>r&&(s=i,i=r,r=s);for(;i<=r;i++)s=this.$control[0].childNodes[i],-1===this.$activeItems.indexOf(s)&&(e(s).addClass("active"),this.$activeItems.push(s));n.preventDefault()}else"mousedown"===r&&this.isCtrlDown||"keydown"===r&&this.isShiftDown?t.hasClass("active")?(r=this.$activeItems.indexOf(t[0]),this.$activeItems.splice(r,1),t.removeClass("active")):this.$activeItems.push(t.addClass("active")[0]):(e(this.$activeItems).removeClass("active"),this.$activeItems=[t.addClass("active")[0]]);this.isFocused=!!this.$activeItems.length||this.isInputFocused}else e(this.$activeItems).removeClass("active"),this.$activeItems=[],this.isFocused=this.isInputFocused},setActiveOption:function(t,n,r){var i,s,o;this.$activeOption&&this.$activeOption.removeClass("active");this.$activeOption=null;t=e(t);t.length&&(this.$activeOption=t.addClass("active"),n||!u(n))&&(t=this.$dropdown_content.height(),i=this.$activeOption.outerHeight(!0),n=this.$dropdown_content.scrollTop()||0,s=this.$activeOption.offset().top-this.$dropdown_content.offset().top+n,o=s-t+i,s+i>t-n?this.$dropdown_content.stop().animate({scrollTop:o},r?this.settings.scrollDuration:0):s<n&&this.$dropdown_content.stop().animate({scrollTop:s},r?this.settings.scrollDuration:0))},selectAll:function(){this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active"));this.isFocused=!0;this.$activeItems.length&&this.hideInput()},hideInput:function(){this.close();this.setTextboxValue("");this.$control_input.css({opacity:0,position:"absolute",left:-1e4});this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=!1},focus:function(e){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),t.isInputFocused=!0,window.setTimeout(function(){t.ignoreFocus=!1;e&&t.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},parseSearchTokens:function(t){t=e.trim(String(t||"").toLowerCase());if(!t||!t.length)return[];var n,r,i,s=[],u=t.split(/ +/);t=0;for(n=u.length;t<n;t++){r=(u[t]+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(this.settings.diacritics)for(i in o)o.hasOwnProperty(i)&&(r=r.replace(RegExp(i,"g"),o[i]));s.push({string:u[t],regex:RegExp(r,"i")})}return s},getScoreFunction:function(e){var t=this,n=e.tokens,r=function(){return n.length?1===n.length?function(e){var t;e=String(e||"").toLowerCase();t=e.search(n[0].regex);if(-1===t)return 0;e=n[0].string.length/e.length;0===t&&(e+=.5);return e}:function(e){var t,r,i,s;e=String(e||"").toLowerCase();i=t=0;for(s=n.length;i<s;i++){r=e.search(n[i].regex);if(-1===r)return 0;0===r&&(t+=.5);t+=n[i].string.length/e.length}return t/n.length}:function(){return 0}}();return function(){var e=t.settings.searchField;"string"==typeof e&&(e=[e]);if(e&&e.length){if(1===e.length){var n=e[0];return function(e){return e.hasOwnProperty(n)?r(e[n]):0}}return function(t){for(var n=0,i=0,s=0,o=e.length;s<o;s++)t.hasOwnProperty(e[s])&&(i+=r(t[e[s]]),n++);return i/n}}return function(){return 0}}()},search:function(t,n){var r=this,i,s,o,u;n=n||{};t=e.trim(String(t||"").toLowerCase());if(t!==r.lastQuery){r.lastQuery=t;o={query:t,tokens:r.parseSearchTokens(t),total:0,items:[]};if(r.settings.score){if(u=r.settings.score.apply(this,[o]),"function"!=typeof u)throw Error('Selectize "score" setting must be a function that returns a function')}else u=r.getScoreFunction(o);if(t.length){for(i in r.options)r.options.hasOwnProperty(i)&&(s=u(r.options[i]),0<s&&o.items.push({score:s,value:i}));o.items.sort(function(e,t){return t.score-e.score})}else{for(i in r.options)r.options.hasOwnProperty(i)&&o.items.push({score:1,value:i});r.settings.sortField&&o.items.sort(function(){var e=r.settings.sortField,t="desc"===r.settings.sortDirection?-1:1;return function(n,i){n=n&&String(r.options[n.value][e]||"").toLowerCase();i=i&&String(r.options[i.value][e]||"").toLowerCase();return n>i?1*t:i>n?-1*t:0}}())}r.currentResults=o}else o=e.extend(!0,{},r.currentResults);return r.prepareResults(o,n)},prepareResults:function(e,t){if(this.settings.hideSelected)for(var n=e.items.length-1;0<=n;n--)-1!==this.items.indexOf(String(e.items[n].value))&&e.items.splice(n,1);e.total=e.items.length;"number"==typeof t.limit&&(e.items=e.items.slice(0,t.limit));return e},refreshOptions:function(n){"undefined"==typeof n&&(n=!0);var r,i,s,o,u,a,f,l=this.$control_input.val(),c=this.search(l,{}),h,p=this.$dropdown_content;i=c.items.length;"number"==typeof this.settings.maxOptions&&(i=Math.min(i,this.settings.maxOptions));s={};if(this.settings.optgroupOrder)for(o=this.settings.optgroupOrder,r=0;r<o.length;r++)s[o[r]]=[];else o=[];for(r=0;r<i;r++)u=this.options[c.items[r].value],a=u[this.settings.optgroupField]||"",this.optgroups.hasOwnProperty(a)||(a=""),s.hasOwnProperty(a)||(s[a]=[],o.push(a)),s[a].push(this.render("option",u));u=[];r=0;for(i=o.length;r<i;r++)a=o[r],this.optgroups.hasOwnProperty(a)&&s[a].length?(f=this.render("optgroup_header",this.optgroups[a])||"",f+=s[a].join(""),u.push(this.render("optgroup",e.extend({},this.optgroups[a],{html:f})))):u.push(s[a].join(""));p.html(u.join(""));if(this.settings.highlight&&c.query.length&&c.tokens.length)for(r=0,i=c.tokens.length;r<i;r++)t(p,c.tokens[r].regex);if(!this.settings.hideSelected)for(r=0,i=this.items.length;r<i;r++)this.getOption(this.items[r]).addClass("selected");if(r=this.settings.create&&c.query.length)p.prepend(this.render("option_create",{input:l})),h=e(p[0].childNodes[0]);(this.hasOptions=0<c.items.length||r)?(l=0<c.items.length?h?this.getAdjacentOption(h,1):p.find("[data-selectable]").first():h,this.setActiveOption(l),n&&!this.isOpen&&this.open()):(this.setActiveOption(null),n&&this.isOpen&&this.close())},addOption:function(t,n){var r,i;if(e.isArray(t))for(r=0,i=t.length;r<i;r++)this.addOption(t[r][this.settings.valueField],t[r]);else t=a(t),this.options.hasOwnProperty(t)||(this.userOptions[t]=!0,this.options[t]=n,this.lastQuery=null,this.trigger("option_add",t,n))},addOptionGroup:function(e,t){this.optgroups[e]=t;this.trigger("optgroup_add",value,t)},updateOption:function(t,n){var r,i,s;t=a(t);r=a(n[this.settings.valueField]);if(this.options.hasOwnProperty(t)){if(!r)throw Error("Value must be set in option data");r!==t&&(delete this.options[t],i=this.items.indexOf(t),-1!==i&&this.items.splice(i,1,r));this.options[r]=n;i=this.renderCache.item;s=this.renderCache.option;u(i)&&(delete i[t],delete i[r]);u(s)&&(delete s[t],delete s[r]);-1!==this.items.indexOf(r)&&(r=this.getItem(t),i=e(this.render("item",n)),r.hasClass("active")&&i.addClass("active"),r.replaceWith(i));this.isOpen&&this.refreshOptions(!1)}},removeOption:function(e){e=a(e);delete this.userOptions[e];delete this.options[e];this.lastQuery=null;this.trigger("option_remove",e);this.removeItem(e)},clearOptions:function(){this.loadedSearches={};this.userOptions={};this.options={};this.lastQuery=null;this.trigger("option_clear");this.clear()},getOption:function(t){return(t=a(t))?this.$dropdown_content.find("[data-selectable]").filter('[data-value="'+l(t)+'"]:first'):e()},getAdjacentOption:function(t,n){var r=this.$dropdown.find("[data-selectable]"),i=r.index(t)+n;return 0<=i&&i<r.length?r.eq(i):e()},getItem:function(e){return this.$control.children('[data-value="'+l(a(e))+'"]')},addItem:function(t){v(this,["change"],function(){var n,r,i=this,s=i.settings.mode,o;t=a(t);"single"===s&&i.clear();"multi"===s&&i.isFull()||-1!==i.items.indexOf(t)||!i.options.hasOwnProperty(t)||(n=e(i.render("item",i.options[t])),i.items.splice(i.caretPos,0,t),i.insertAtCaret(n),i.refreshClasses(),i.isSetup&&(o=i.$dropdown_content.find("[data-selectable]"),r=i.getOption(t),r=i.getAdjacentOption(r,1).attr("data-value"),i.refreshOptions(i.isFocused&&"single"!==s),r&&i.setActiveOption(i.getOption(r)),!o.length||null!==i.settings.maxItems&&i.items.length>=i.settings.maxItems?i.close():i.positionDropdown(),i.isFocused&&window.setTimeout(function(){"single"===s?(i.blur(),i.focus(!1),i.hideInput()):i.focus(!1)},0),i.updatePlaceholder(),i.trigger("item_add",t,n),i.updateOriginalInput()))})},removeItem:function(e){var t,n;t="object"==typeof e?e:this.getItem(e);e=a(t.attr("data-value"));n=this.items.indexOf(e);-1!==n&&(t.remove(),t.hasClass("active")&&(t=this.$activeItems.indexOf(t[0]),this.$activeItems.splice(t,1)),this.items.splice(n,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(e)&&this.removeOption(e),n<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshClasses(),this.updatePlaceholder(),this.updateOriginalInput(),this.positionDropdown(),this.trigger("item_remove",e))},createItem:function(){var t=this,n=e.trim(t.$control_input.val()||""),r=t.caretPos;if(n.length){t.lock();var i="function"==typeof t.settings.create?this.settings.create:function(e){var n={};n[t.settings.labelField]=e;n[t.settings.valueField]=e;return n},s=p(function(e){t.unlock();t.focus(!1);if(e&&"object"==typeof e){var n=a(e[t.settings.valueField]);n&&(t.setTextboxValue(""),t.addOption(n,e),t.setCaret(r),t.addItem(n),t.refreshOptions("single"!==t.settings.mode),t.focus(!1))}}),n=i.apply(this,[n,s]);"undefined"!=typeof n&&s(n)}},refreshItems:function(){this.lastQuery=null;if(this.isSetup)for(var e=0;e<this.items.length;e++)this.addItem(this.items);this.refreshClasses();this.updateOriginalInput()},refreshClasses:function(){var e=this.isFull(),t=this.isLocked;this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("locked",t).toggleClass("full",e).toggleClass("not-full",!e).toggleClass("dropdown-active",this.isOpen).toggleClass("has-items",0<this.items.length);this.$control_input.data("grow",!e&&!t)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var e,t,n;if("select"===this.$input[0].tagName.toLowerCase()){n=[];e=0;for(t=this.items.length;e<t;e++)n.push('<option value="'+f(this.items[e])+'" selected="selected"></option>');n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>');this.$input.html(n.join(""))}else this.$input.val(this.getValue());this.$input.trigger("change");this.isSetup&&this.trigger("change",this.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var e=this.$control_input;this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder);e.triggerHandler("update")}},open:function(){this.isLocked||this.isOpen||"multi"===this.settings.mode&&this.isFull()||(this.focus(!0),this.isOpen=!0,this.refreshClasses(),this.$dropdown.css({visibility:"hidden",display:"block"}),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),this.trigger("dropdown_open",this.$dropdown))},close:function(){this.isOpen&&(this.$dropdown.hide(),this.setActiveOption(null),this.isOpen=!1,this.refreshClasses(),this.trigger("dropdown_close",this.$dropdown))},positionDropdown:function(){var e=this.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0);this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(){this.items.length&&(this.$control.children(":not(input)").remove(),this.items=[],this.setCaret(0),this.updatePlaceholder(),this.updateOriginalInput(),this.refreshClasses(),this.showInput(),this.trigger("clear"))},insertAtCaret:function(t){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(t):e(this.$control[0].childNodes[n]).before(t);this.setCaret(n+1)},deleteSelection:function(t){var n,r,i,s,o;n=t&&8===t.keyCode?-1:1;r=g(this.$control_input[0]);this.$activeOption&&!this.settings.hideSelected&&(o=this.getAdjacentOption(this.$activeOption,-1).attr("data-value"));i=[];if(this.$activeItems.length){s=this.$control.children(".active:"+(0<n?"last":"first"));s=this.$control.children(":not(input)").index(s);0<n&&s++;n=0;for(r=this.$activeItems.length;n<r;n++)i.push(e(this.$activeItems[n]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(0>n&&0===r.start&&0===r.length?i.push(this.items[this.caretPos-1]):0<n&&r.start===this.$control_input.val().length&&i.push(this.items[this.caretPos]));if(!i.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete(i))return!1;for("undefined"!=typeof s&&this.setCaret(s);i.length;)this.removeItem(i.pop());this.showInput();this.refreshOptions(!0);o&&(t=this.getOption(o),t.length&&this.setActiveOption(t));return!0},advanceSelection:function(e,t){var n,r;0!==e&&(n=0<e?"last":"first",r=g(this.$control_input[0]),this.isInputFocused&&!this.isInputHidden?(n=this.$control_input.val().length,(r=0>e?0===r.start&&0===r.length:r.start===n)&&!n&&this.advanceCaret(e,t)):(r=this.$control.children(".active:"+n),r.length&&(r=this.$control.children(":not(input)").index(r),this.setActiveItem(null),this.setCaret(0<e?r+1:r),this.showInput())))},advanceCaret:function(e,t){if(0!==e){var n=0<e?"next":"prev";this.isShiftDown?(n=this.$control_input[n](),n.length&&(this.hideInput(),this.setActiveItem(n),t&&t.preventDefault())):this.setCaret(this.caretPos+e)}},setCaret:function(t){t="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,t));var n,r,i,s;i=this.$control.children(":not(input)");n=0;for(r=i.length;n<r;n++)s=e(i[n]).detach(),n<t?this.$control_input.before(s):this.$control.append(s);this.caretPos=t},lock:function(){this.close();this.isLocked=!0;this.refreshClasses()},unlock:function(){this.isLocked=!1;this.refreshClasses()},disable:function(){this.isDisabled=!0;this.lock()},enable:function(){this.isDisabled=!1;this.unlock()},render:function(e,t){var n,r,i="",s=!1,o=/^[\\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if("option"===e||"item"===e)n=a(t[this.settings.valueField]),s=!!n;if(s&&(u(this.renderCache[e])||(this.renderCache[e]={}),this.renderCache[e].hasOwnProperty(n)))return this.renderCache[e][n];if(this.settings.render&&"function"==typeof this.settings.render[e])i=this.settings.render[e].apply(this,[t,f]);else switch(r=t[this.settings.labelField],e){case"optgroup":i='<div class="optgroup">'+t.html+"</div>";break;case"optgroup_header":r=t[this.settings.optgroupLabelField];i='<div class="optgroup-header">'+f(r)+"</div>";break;case"option":i='<div class="option">'+f(r)+"</div>";break;case"item":i='<div class="item">'+f(r)+"</div>";break;case"option_create":i='<div class="create">Add <strong>'+f(t.input)+"</strong>&hellip;</div>"}if("option"===e||"option_create"===e)i=i.replace(o,"<$1 data-selectable");"optgroup"===e&&(r=t[this.settings.optgroupValueField]||"",i=i.replace(o,'<$1 data-group="'+f(r)+'"'));if("option"===e||"item"===e)i=i.replace(o,'<$1 data-value="'+f(n||"")+'"');s&&(this.renderCache[e][n]=i);return i}});b.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",sortField:null,sortDirection:"asc",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,searchField:["text"],mode:null,theme:"default",wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}};e.fn.selectize=function(t){t=t||{};var n=e.fn.selectize.defaults,r=t.dataAttr||n.dataAttr,i=function(t,n){var i,s,o,u;n.maxItems=t.attr("multiple")?null:1;var a=function(e){e=r&&e.attr(r);return"string"==typeof e&&e.length?JSON.parse(e):null},f=function(t,r){t=e(t);var i=t.attr("value")||"";i.length&&(n.options[i]=a(t)||{text:t.text(),value:i,optgroup:r},t.is(":selected")&&n.items.push(i))},l=function(t){var r,i=e("option",t);t=e(t);var s=t.attr("label");s&&s.length&&(n.optgroups[s]=a(t)||{label:s});t=0;for(r=i.length;t<r;t++)f(i[t],s)};u=t.children();i=0;for(s=u.length;i<s;i++)o=u[i].tagName.toLowerCase(),"optgroup"===o?l(u[i]):"option"===o&&f(u[i])};return this.each(function(){var r,s=e(this),o=s[0].tagName.toLowerCase();r={placeholder:s.children('option[value=""]').text()||s.attr("placeholder"),options:{},optgroups:{},items:[]};if("select"===o)i(s,r);else{var u,a,o=e.trim(s.val()||"");if(o.length){a=o.split(t.delimiter||n.delimiter);o=0;for(u=a.length;o<u;o++)r.options[a[o]]={text:a[o],value:a[o]};r.items=a}}r=new b(s,e.extend(!0,{},n,r,t));s.data("selectize",r);s.addClass("selectized")})};e.fn.selectize.defaults=b.defaults;b.registerPlugin("drag_drop",function(t){if(!e.fn.sortable)throw Error('The "drag_drop" Selectize plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var n=this;this.setup=function(){var t=n.setup;return function(){t.apply(this,arguments);var r=this.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,start:function(e,t){t.placeholder.css("width",t.helper.css("width"));r.css({overflow:"visible"})},stop:function(){r.css({overflow:"hidden"});var t=this.$activeItems?this.$activeItems.slice():null,i=[];r.children("[data-value]").each(function(){i.push(e(this).attr("data-value"))});n.setValue(i);n.setActiveItem(t)}})}}()}});b.registerPlugin("dropdown_header",function(t){var n=this;t=e.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a></div></div>'}},t);n.setup=function(){var r=n.setup;return function(){r.apply(n,arguments);n.$dropdown_header=e(t.html(t));n.$dropdown.prepend(n.$dropdown_header)}}()});b.registerPlugin("optgroup_columns",function(t){var n=this;t=e.extend({equalizeWidth:!0,equalizeHeight:!0},t);this.getAdjacentOption=function(t,n){var r=t.closest("[data-group]").find("[data-selectable]"),i=r.index(t)+n;return 0<=i&&i<r.length?r.eq(i):e()};this.onKeyDown=function(){var e=n.onKeyDown;return function(t){var r,i;if(!this.isOpen||37!==t.keyCode&&39!==t.keyCode)return e.apply(this,arguments);n.ignoreHover=!0;i=this.$activeOption.closest("[data-group]");r=i.find("[data-selectable]").index(this.$activeOption);i=37===t.keyCode?i.prev("[data-group]"):i.next("[data-group]");i=i.find("[data-selectable]");r=i.eq(Math.min(i.length-1,r));r.length&&this.setActiveOption(r)}}();var r=function(){var r,i,s,o;o=e("[data-group]",n.$dropdown_content);if((i=o.length)&&n.$dropdown_content.width()){if(t.equalizeHeight){for(r=s=0;r<i;r++)s=Math.max(s,o.eq(r).height());o.css({height:s})}t.equalizeWidth&&(s=n.$dropdown_content.innerWidth(),r=Math.round(s/i),o.css({width:r}),1<i&&(r=s-r*(i-1),o.eq(i-1).css({width:r})))}};if(t.equalizeHeight||t.equalizeWidth)c.after(this,"positionDropdown",r),c.after(this,"refreshOptions",r)});b.registerPlugin("remove_button",function(t){var n=this;this.settings.render.item=function(e){return'<div class="item">'+e[n.settings.labelField]+' <a href="javascript:void(0)" class="remove" tabindex="-1" title="Remove">&times;</a></div>'};this.setup=function(){var t=n.setup;return function(){t.apply(this,arguments);this.$control.on("click",".remove",function(t){t.preventDefault();t=e(t.target).parent();n.setActiveItem(t);n.deleteSelection()&&n.setCaret(n.items.length)})}}()});b.registerPlugin("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]};this.onKeyDown=function(n){var r=t.onKeyDown;return function(t){var n;if(8===t.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&(n=this.caretPos-1,0<=n&&n<this.items.length)){n=this.options[this.items[n]];this.deleteSelection(t)&&(this.setTextboxValue(e.text.apply(this,[n])),this.refreshOptions(!0));t.preventDefault();return}return r.apply(this,arguments)}}()});return b});